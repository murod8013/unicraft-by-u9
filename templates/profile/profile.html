{% extends 'base.html' %}
{% load static %}

{% block content %}

<style>
    .avatar-wrapper {
        position: relative;
        width: 170px;
        height: 170px;
        margin: 0 auto 20px;
    }

    .avatar-img {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        object-fit: cover;
        box-shadow: 0 4px 10px rgba(0,0,0,.2);
        transition: .3s ease-in-out;
    }

    .avatar-wrapper:hover .avatar-img {
        filter: brightness(70%);
        transform: scale(1.03);
    }

    .avatar-overlay {
        position: absolute;
        top: 0; left: 0;
        width: 100%; height: 100%;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 38px;
        opacity: 0;
        transition: .3s;
        cursor: pointer;
        background: rgba(0,0,0,0);
    }

    .avatar-wrapper:hover .avatar-overlay {
        opacity: 1;
        background: rgba(0,0,0,0.4);
    }
</style>

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card shadow p-4 border-0 rounded-4">

                <h2 class="mb-4 fw-bold text-center">
                    {% if student_profile %}
                    {{ student_profile.full_name}}
                    {% else %}
                    {{ request.user.get_full_name}}
                    {% endif%}'s  Profile
                </h2>

                <!-- AAAASOSIY FORM BOSHLANDI -->
                <form method="POST" enctype="multipart/form-data">
                    {% csrf_token %}

                    <div class="row">

                        <!-- LEFT : Avatar -->
                        <div class="col-md-4 text-center border-end">
                            <div class="avatar-wrapper">
                                {% if student.avatar %}
                                <img id="avatarImage" src="{{ student.avatar.url }}" class="avatar-img">
                                {% else %}
                                <img id="avatarImage"
                                     src="https://cdn-icons-png.flaticon.com/512/149/149071.png"
                                     class="avatar-img">
                                {% endif %}
                                <div class="avatar-overlay" onclick="document.getElementById('id_avatar').click();">
                                    <i class="bi bi-pencil-fill"></i>
                                </div>
                            </div>

                            <!-- Hidden avatar input -->
                            <!--                            {{ student_form.avatar }}-->
                            <input type="file" id="id_avatar" name="avatar" style="display:none;">

                        </div>




                        <!-- RIGHT : Profile fields -->
                        <div class="col-md-8">
                            <div class="bg-light p-3 rounded-3 border">

                                <!-- StudentProfile fields -->
                                {% for field in profile_form %}
                                <div class="form-group mb-3">
                                    <label>{{ field.label }}</label>
                                    {{ field }}
                                    {% if field.errors %}
                                    <div class="text-danger small">{{ field.errors }}</div>
                                    {% endif %}
                                </div>
                                {% endfor %}

                                <!-- Student fields (excluding avatar) -->
                                {% for field in student_form %}
                                {% if field.name != 'avatar' %}
                                <div class="form-group mb-3">
                                    <label>{{ field.label }}</label>
                                    {{ field }}
                                    {% if field.errors %}
                                    <div class="text-danger small">{{ field.errors }}</div>
                                    {% endif %}
                                </div>
                                {% endif %}
                                {% endfor %}
                            </div>

                            <button type="submit" class="btn btn-success mt-3 px-4">Saqlash</button>
                        </div>

                    </div>

                </form>
                <!-- FORM YOPILDI -->

            </div>
        </div>
    </div>
</div>

<script>
    function previewAvatar(event) {
        const img = document.getElementById('avatarImage');
        img.src = URL.createObjectURL(event.target.files[0]);
    }

    document.getElementById('id_avatar')?.addEventListener('change', previewAvatar);
</script>

{% endblock %}
